# 簡単字幕焼き付けx264.exeエンコード (automp4encoder)

右クリックの送るメニューやドラッグ＆ドロップで簡単にx264.exeを使って簡単にass形式の字幕を焼き付けながらmp4ファイルにエンコードするためのバッチファイル



## 初期設定

1. (つんでれんこでエンコードする場合)  
まず「つんでれんこ」をダウンロードして使えるようにしておく。[http://tdenc.com/](http://tdenc.com/)  
mp4fromavitd.batをメモ帳などで開き(右クリックで編集でOK) 3行目の

    ````
    set CMDTDE="C:\tde\【ここに動画をD&D】.bat"
    ````

    につんでれんこのバッチファイルがあるパスに変更。  
2. (つんでれんこをインストールしていない場合)  
setupフォルダの中にある「AviSynth_260.exe」を実行してavisynthをインストール  
3. LAV Filtersをダウンロードしてきてインストールする。  
（配布元） [https://github.com/Nevcairiel/LAVFilters/releases](https://github.com/Nevcairiel/LAVFilters/releases)  
LAVFilters-0.XX-Installer.exe をダウンロードしてきて実行。  
インストールオプション等は最初からついているチェックのままでOK。  
4. makesendto.batを実行してsendtoメニューを追加する。  
5. (任意)setupフォルダの中のavisynth.dll ファイルは  
C:\Windows\SysWOW64  
もしくは  
C:\Windows\System32  
内にある同名のファイルに上書きすると処理が速くなるかもしれないのでお好みで

## 使用方法

### 通常エンコード
Intel QSV に対応しているCPU搭載のPCの場合 mp4fromavi_qsv.bat を使用。  
それ以外は mp4fromavi.bat を使用する。  
（わかんなかったら mp4fromavi_qsv.batを使ってみてエラーが出たらmp4fromavi.bat使えばいい）  

エクスプローラーにて動画ファイル(.aviや.mp4や.mpgファイル等もしくは.avsファイル)と字幕assファイル(複数可)を選択して右クリック→送る(N)→mp4fromavi_qsv.batへのショートカット
（もしくは mp4fromavi_qsv.bat にドラッグ＆ドロップ）
※mp4fromavi.batを使う場合は「mp4fromavi.batへのショートカット」

後は待つだけで元の動画ファイルがあった場所に同ファイル名で拡張子がmp4になったファイルが出来上がり

ムービーファイルだけ選択すると単純にmp4形式に変換  
ムービーとassファイルを選択すると字幕を焼き付けてエンコードを行う

### つんでれんこでエンコード
エクスプローラーにて動画ファイル(.aviや.mp4や.mpgファイル等)と字幕assファイル(複数可)を選択して右クリック→送る(N)→mp4fromavitd.batへのショートカット
（もしくは mp4fromavitd.bat にドラッグ＆ドロップ）

以降、つんでれんこのメニューに従って選択肢を選択していけばニコ動oryoutube用のエンコードできる。

## カスタマイズ

### 映像エンコード画質の調整

mp4fromavi.bat をメモ帳などで開いて 1行目
````
set VIDEOQUALITY=24
````
の24の数字を変更
0が最高画質で数字が大きいほど圧縮率が上がる。

作者の主観では20以下に下げてもファイルが大きくなるだけで見た目変わらないので20以上推奨
動画編集中の中間ファイル作成の場合は2～4を指定するといいと思う。

### 音声エンコード画質の調整
mp4fromavi.bat をメモ帳などで開いて 2行目
````
set AUDIOQUALITY=0.95
````
の0.95の数字を変更
1が最高音質で数字が小さいほど圧縮率が上がる。最小は0
映像に比べて音声は圧縮率を上げてもたいして容量の削減にならないので高めの設定。
それでも容量を減らしたい場合は 0に近づけていって試してみて。

## あとがき
ありそうな質問

Q. エンコード前に字幕が入った動画をプレビューしたい。  
A. AegiSubで確認するのがいいと思う。不安定とかいう人いるけど少なくともうちではプレビュー用途で止まったことはない。

## 更新履歴
2016.02.09 初版作成 単純にaviファイルをmp4にエンコードするだけ  
2016.02.10 v0.0.2   aviファイル以外の動画ファイルにも対応  
2016.02.10 v0.0.3   つんでれんこ対応。ファイル選択の順番を気にしなくてよくなった。  SendToショートカット自動生成コマンド追加
2016.02.27 v0.0.4   avsファイル対応
2016.07.21 v0.0.5   セットアップにDLLのコピーが不要となった。エンコード後音が早送りになった不具合を解消
2016.07.24 v0.0.6   QSVエンコードに対応。

## バグ
ファイル名に 「,」(半角カンマ)が入っていると処理に失敗する
