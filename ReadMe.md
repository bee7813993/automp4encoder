# 簡単字幕焼き付けx264.exeエンコード (automp4encoder)

右クリックの送るメニューやドラッグ＆ドロップで簡単にx264.exeを使って簡単にass形式の字幕を焼き付けながらmp4ファイルにエンコードするためのバッチファイル



## 初期設定

1. (つんでれんこでエンコードする場合)  
まず「つんでれんこ」をダウンロードして使えるようにしておく。[http://tdenc.com/](http://tdenc.com/)  
mp4fromavitd.batをメモ帳などで開き(右クリックで編集でOK) 3行目の

    ````
    set CMDTDE="C:\tde\【ここに動画をD&D】.bat"
    ````

    につんでれんこのバッチファイルがあるパスに変更。  
2. (つんでれんこをインストールしていない場合)  
setupフォルダの中にある「AviSynth_260.exe」を実行してavisynthをインストール  
3. LAV Filtersをダウンロードしてきてインストールする。  
（配布元） [https://github.com/Nevcairiel/LAVFilters/releases](https://github.com/Nevcairiel/LAVFilters/releases)  
LAVFilters-0.XX-Installer.exe をダウンロードしてきて実行。  
インストールオプション等は最初からついているチェックのままでOK。  
4. makesendto.batを実行してsendtoメニューを追加する。  
5. 実行中に 「MSVCR100.dllがありません」などのエラーが出る場合は  
https://www.microsoft.com/ja-jp/download/details.aspx?id=8328 より vcredist_x86.exeをダウンロードして実行しておく。  
6. (任意)setupフォルダの中のavisynth.dll ファイルは  
C:\Windows\SysWOW64  
もしくは  
C:\Windows\System32  
内にある同名のファイルに上書きすると処理が速くなるかもしれないのでお好みで

## 使用方法

### 通常エンコード
Intel QSV に対応しているCPU搭載のPCの場合 mp4fromavi_qsv.bat を使用。  
それ以外は mp4fromavi.bat を使用する。  
（わかんなかったら mp4fromavi_qsv.batを使ってみてエラーが出たらmp4fromavi.bat使えばいい）  

エクスプローラーにて動画ファイル(.aviや.mp4や.mpgファイル等もしくは.avsファイル)と字幕assファイル(複数可)を選択して右クリック→送る(N)→mp4fromavi_qsv.batへのショートカット
（もしくは mp4fromavi_qsv.bat にドラッグ＆ドロップ）
※mp4fromavi.batを使う場合は「mp4fromavi.batへのショートカット」

コマンドプロンプトが現れて、圧縮品質を聞いてくるので、適当に数値を入力してEnter。後は待つだけで元の動画ファイルがあった場所に同ファイル名で拡張子がmp4になったファイルが出来上がり

ムービーファイルだけ選択して実行すると単純にmp4形式に変換  
ムービーとassファイルを選択して実行すると字幕を焼き付けてエンコードを行う

### つんでれんこでエンコード
エクスプローラーにて動画ファイル(.aviや.mp4や.mpgファイル等)と字幕assファイル(複数可)を選択して右クリック→送る(N)→mp4fromavitd.batへのショートカット
（もしくは mp4fromavitd.bat にドラッグ＆ドロップ）

以降、つんでれんこのメニューに従って選択肢を選択していけばニコ動oryoutube用のエンコードできる。

## カスタマイズ

### 圧縮品質の問い合わせの省略

毎回聞いてくるのが煩わしいと思ったら設定で決まった値にして省略できる

～.bat をメモ帳などで開いて 13行目くらい
````
set VIDEOQUALITY=
````
の後ろに数字を記入
24を指定する例
````
set VIDEOQUALITY=24
````


### 音声エンコード画質の調整
～.bat をメモ帳などで開いて 14行目くらい
````
set AUDIOQUALITY=0.95
````
の0.95の数字を変更
1が最高音質で数字が小さいほど圧縮率が上がる。最小は0
映像に比べて音声は圧縮率を上げてもたいして容量の削減にならないので高めの設定。
それでも容量を減らしたい場合は 0に近づけていって試してみて。

## あとがき
ありそうな質問

Q. エンコード前に字幕が入った動画をプレビューしたい。  
A. AegiSubで確認するのがいいと思う。不安定とかいう人いるけど少なくともうちではプレビュー用途で止まったことはない。

Q. 動画の圧縮品質って何を指定したらいいの？
A. 作者の主観では20以下に下げてもファイルが大きくなるだけで見た目変わらないので20以上推奨
実写の映像は圧縮率が低くなるので+10くらいすると同じくらいのサイズになる。
動画編集中の中間ファイル作成の場合は2～4を指定するといいと思う。


## 更新履歴
2016.02.09 初版作成 単純にaviファイルをmp4にエンコードするだけ  
2016.02.10 v0.0.2   aviファイル以外の動画ファイルにも対応  
2016.02.10 v0.0.3   つんでれんこ対応。ファイル選択の順番を気にしなくてよくなった。  SendToショートカット自動生成コマンド追加  
2016.02.27 v0.0.4   avsファイル対応  
2016.07.21 v0.0.5   セットアップにDLLのコピーが不要となった。エンコード後音が早送りになった不具合を解消  
2016.07.24 v0.0.6   QSVエンコードに対応  
2016.08.23 v0.0.7   MP4BOX用DLLを追加  
2016.10.31 v0.0.7   動画の圧縮品質の問い合わせ対応。各ツールのアップデート

## バグ
ファイル名に 「,」(半角カンマ)や「!」（半角ビックリマーク）等が入っていると処理に失敗する
